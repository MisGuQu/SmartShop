<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartShop | Quản lý đơn hàng</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>
<header class="admin-header">
    <div class="admin-header__title">
        <a class="admin-header__logo" href="/">SmartShop</a>
        <span class="admin-header__subtitle">Bảng điều khiển quản trị</span>
    </div>
    <nav class="admin-header__nav">
        <a class="admin-header__link" href="/admin/dashboard">Dashboard</a>
        <a class="admin-header__link" href="/admin/products">Sản phẩm</a>
        <a class="admin-header__link" href="/admin/users">Người dùng</a>
        <a class="admin-header__link admin-header__link--active" href="/admin/orders">Đơn hàng</a>
    </nav>
</header>

<main class="admin-main">
    <section class="admin-card admin-card--stack">
        <div class="admin-card__header">
            <div>
                <h1 class="admin-card__title">Quản lý đơn hàng</h1>
                <p class="admin-card__subtitle">Xem và quản lý tất cả đơn hàng trong hệ thống.</p>
            </div>
            <div class="admin-card__actions">
                <a class="admin-chip" href="/admin/dashboard">Dashboard</a>
            </div>
        </div>

        <div th:if="${successMessage}" class="alert alert--success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="alert alert--error" th:text="${errorMessage}"></div>
    </section>

    <!-- Filter and Search Section -->
    <section class="admin-card">
        <div class="admin-card__header">
            <div>
                <h2 class="admin-card__title">Tìm kiếm và lọc</h2>
                <p class="admin-card__subtitle">Tìm kiếm đơn hàng theo tên hoặc SĐT khách hàng, lọc theo trạng thái.</p>
            </div>
        </div>
        <form method="get" action="/admin/orders" style="display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #0f172a;">Tìm kiếm</label>
                <input type="text" 
                       name="keyword" 
                       th:value="${currentKeyword}"
                       placeholder="Tên hoặc SĐT khách hàng"
                       style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem;">
            </div>
            <div style="flex: 1; min-width: 200px;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #0f172a;">Lọc theo trạng thái</label>
                <select name="status" 
                        style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem; background: #ffffff; cursor: pointer;">
                    <option value="">Tất cả trạng thái</option>
                    <option th:each="status : ${orderStatuses}" 
                            th:value="${status.name()}" 
                            th:text="${status.name()}"
                            th:selected="${currentStatus == status.name()}"></option>
                </select>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button type="submit" class="button button--primary" style="padding: 0.5rem 1.5rem;">Tìm kiếm</button>
                <a href="/admin/orders" class="button button--ghost" style="padding: 0.5rem 1.5rem;">Xóa bộ lọc</a>
            </div>
        </form>
    </section>

    <!-- Orders Table -->
    <section class="admin-card">
        <div class="admin-card__header">
            <div>
                <h2 class="admin-card__title">Danh sách đơn hàng</h2>
                <p class="admin-card__subtitle">Tất cả đơn hàng trong hệ thống.</p>
            </div>
        </div>

        <div class="table-wrapper">
            <table class="table">
                <thead>
                <tr>
                    <th>Mã đơn hàng</th>
                    <th>Khách hàng</th>
                    <th>SĐT</th>
                    <th>Ngày đặt</th>
                    <th>Tổng tiền</th>
                    <th>Trạng thái</th>
                    <th class="table__actions-col">Hành động</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="order : ${orders}">
                    <td>
                        <div class="table__primary">
                            <span th:text="${order.orderNumber}"></span>
                        </div>
                    </td>
                    <td th:text="${order.customerName}"></td>
                    <td th:text="${order.customerPhone}"></td>
                    <td th:text="${order.orderDate != null ? #temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm') : '-'}"></td>
                    <td>
                        <span style="font-weight: 600; color: #10b981;">
                            <span th:text="${#numbers.formatDecimal(order.totalAmount, 1, 'POINT', 0, 'COMMA')}"></span> ₫
                        </span>
                    </td>
                    <td>
                        <span class="status" 
                              th:classappend="${order.status.name() == 'PENDING'} ? 'status--warning' : 
                                             (${order.status.name() == 'PROCESSING'} ? 'status--info' :
                                             (${order.status.name() == 'SHIPPING'} ? 'status--info' :
                                             (${order.status.name() == 'DELIVERED'} ? 'status--active' :
                                             (${order.status.name() == 'CANCELLED'} ? 'status--inactive' : 'status--secondary'))))"
                              th:text="${order.status.name()}"></span>
                    </td>
                    <td class="table__actions">
                        <a class="button button--ghost" th:href="@{/admin/orders/{id}(id=${order.id})}">Xem chi tiết</a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(orders)}">
                    <td colspan="7" class="table__empty">Không có đơn hàng nào.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>
</main>

</body>
</html>

